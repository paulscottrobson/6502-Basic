; ************************************************************************************************
; ************************************************************************************************
;
;		Name:		stopend.asm
;		Purpose:	Stop and End
;		Created:	26th February 2021
;		Reviewed: 	7th March 2021
;		Author:		Paul Robson (paul@robsons.org.uk)
;
; ************************************************************************************************
; ************************************************************************************************

		.section code

; ************************************************************************************************
;
;											Stop command
;
; ************************************************************************************************

CommandStop:	;; [stop]
		error 	Stop

; ************************************************************************************************
;
;											  End command
;
; ************************************************************************************************

CommandEnd:		;; [end]
		jmp 	$FFFF 						; fudge to crash out of emulator				

; ************************************************************************************************
;
;									  End of line handler
;
; ************************************************************************************************
		
AdvanceNextLine:	;; [[[EOL]]]		
		ldy 	#0 							; get offset
		lda 	(codePtr),y
		clc 								; add to codePtr
		adc 	codePtr
		sta 	codePtr
		bcc 	_ANLNoCarry
		inc 	codePtr+1
_ANLNoCarry:
		lda 	(codePtr),y 				; if end of program (or was just stand alone.
		beq 	CommandEnd 					; execute END
		ldy 	#3 							; start of tokens on line.
		rts

		.send 	code
		
; ************************************************************************************************
;
;									Changes and Updates
;
; ************************************************************************************************
;
;		Date			Notes
;		==== 			=====
;		07-Mar-21 		Pre code read v0.01
;
; ************************************************************************************************
		